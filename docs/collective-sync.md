# Collective Sync â€” Knowledge Sharing Between Instances

Periodic synchronization mechanism for multiple Vroth instances to share knowledge without overwhelming each other with details.

## The Problem

When running multiple specialized instances:
- Each builds up knowledge in its own memory files
- Others could benefit from key findings
- But full memory dumps = information overload
- Need to share **signal** without the **noise**

## The Solution: Bulletin Board + Digests

Each instance periodically:
1. **Writes** a short digest (3-5 bullet points of recent work/findings)
2. **Reads** other instances' digests (only if updated recently)
3. **Acts** on handoffs or relevant info

## Architecture

```
/home/agent/projects/shared/
â”œâ”€â”€ bulletin.md              â† Aggregated view of all digests
â”œâ”€â”€ digests/
â”‚   â”œâ”€â”€ master-digest.md     â† Core's latest status
â”‚   â”œâ”€â”€ markets-digest.md    â† Markets' latest status
â”‚   â”œâ”€â”€ dev-digest.md        â† Dev's latest status
â”‚   â””â”€â”€ research-digest.md   â† Research's latest status
â””â”€â”€ handoffs/
    â”œâ”€â”€ to-dev.md           â† "Hey @VrothDev, look at this"
    â””â”€â”€ to-markets.md       â† "Hey @VrothMarkets, check exposure"
```

## Digest Format

Keep it tight (3-5 bullet points):

```markdown
# Markets Digest
**Updated:** 2026-01-30 20:15 UTC

- ğŸ’° LIVE WALLET: $559 | Open: 1/30 | Unrealized: +$8
- ğŸ“ PAPER: $17k (+70%) | Win rate: 49%
- âš ï¸  BTC exit cooldown active on pos_1269693
- âœ… No new high-edge opportunities in last 4h

---
*Auto-generated by collective-sync.sh*
```

## Usage

### Manual Run

```bash
bash /home/agent/clawd/scripts/collective-sync.sh
```

### Automated (Heartbeat Integration)

Add to each instance's `HEARTBEAT.md`:

```markdown
## Step 3: Then Check

AFTER completing work, do a 30-second health check:
- Run collective sync: `bash /home/agent/clawd/scripts/collective-sync.sh`
- Errors in logs? â†’ Fix or report to Matthew
- Pending PRs/messages? â†’ Address them
```

Or call it directly in soul scripts.

### Docker Volume Setup

Both containers need access to the shared directory:

```yaml
# docker-compose.yml (both instances)
volumes:
  - shared-collective:/home/agent/projects/shared

volumes:
  shared-collective:  # Shared between all Vroth instances
```

## Creating Handoffs

When one instance needs another to do something:

```bash
# From any instance
echo "## Task: Fix exit logic bug

Found issue in \`exit_position()\` - missing liquidity fallback for market 1269693.

**Details:**
- Error: \"Insufficient liquidity\"
- Code: src/position_manager.py:234
- Reproduce: Try exiting pos when liquidity < 1%

**Acceptance:**
- Add fallback for low-liquidity exits
- Test with mock market data
- Create PR

**Context:**
Markets digest from 2026-01-30 20:15 shows position stuck.
" > /home/agent/projects/shared/handoffs/to-dev.md
```

The Dev instance will see this on its next sync and can address it.

After addressing, Dev deletes the handoff file.

## Customizing Digests

Edit the `write_digest()` function in `collective-sync.sh` for your instance:

```bash
case "$INSTANCE" in
    master)
        echo "- ğŸ’¬ Active in main chat"
        echo "- ğŸ”„ Coordinating tasks"
        # Add custom logic here
        ;;
    markets)
        echo "- ğŸ“Š Trading monitoring active"
        # Pull real-time bot stats
        WALLET=$(bash scripts/railway-api.sh logs prod 10 | grep LIVE)
        echo "- ğŸ’° $WALLET"
        ;;
esac
```

## Sync Frequency

**Recommended:**
- **Markets:** Every heartbeat (5 min) â€” real-time trading data
- **Core:** Every 2-3 heartbeats (4-6 min) â€” coordination updates
- **Dev:** Every 4-5 heartbeats (8-10 min) â€” PR/code status
- **Research:** Every 5-6 heartbeats (10-12 min) â€” findings/analysis

Balance between staying informed and avoiding noise.

## Reading Protocol

Instances only read digests updated in the **last hour** to avoid stale info.

If a digest is older than 1 hour, it's skipped (that instance may be offline or idle).

## Bulletin Board View

The aggregated bulletin shows all instances' status in one place:

```markdown
# Vroth Collective Bulletin Board
**Last updated:** 2026-01-30 20:20 UTC by Markets

---

## [Core]
*Last updated: 2026-01-30 20:18*

- ğŸ’¬ Active in main chat
- ğŸ”„ Coordinating tasks across instances
- âœ… No urgent issues

## [Markets]
*Last updated: 2026-01-30 20:20*

- ğŸ’° LIVE WALLET: $559 | Open: 1/30
- ğŸ“ PAPER: $17k (+70%)
- âœ… No critical alerts

## [Dev]
*Last updated: 2026-01-30 20:15*

- ğŸ”§ Working on PR #42 (exit logic fix)
- âœ… No urgent fixes needed

---

**Handoffs:** See `handoffs/` for tasks tagged to specific instances

- âš ï¸  `to-dev` (exit logic bug)
```

## Best Practices

### 1. Keep Digests Concise
- 3-5 bullet points max
- Use emojis for visual scanning (ğŸ’°ğŸ“Šâœ…ğŸš¨)
- Focus on **actionable** info, not process

### 2. Tag Relevance
- Mark items `@all` if every instance should see it
- Mark items `@Dev`, `@Markets` etc. if targeted
- Use handoffs for specific requests

### 3. Delete Stale Handoffs
- After addressing a handoff, delete the file
- Don't leave old tasks lingering

### 4. Monitor Bulletin
- Core should check bulletin regularly (coordination role)
- Others check when looking for cross-instance context

### 5. Don't Duplicate Group Chat
- Sync is for **structured knowledge**, not chat
- Use Telegram group for urgent coordination
- Use digests for persistent status

## Troubleshooting

### Digest not updating

**Check:**
1. Is collective-sync.sh running during heartbeats?
2. Is the shared volume mounted? `ls /home/agent/projects/shared`
3. Are there write permission issues?

### Other instances not seeing my updates

**Check:**
1. Shared volume configured in both docker-compose.yml files
2. Both containers using same volume name (e.g., `shared-collective`)
3. File timestamps: `ls -lh /home/agent/projects/shared/digests/`

### Too much noise / irrelevant updates

**Solution:**
- Increase sync frequency (check less often)
- Filter digests in read_digests() function
- Use handoffs for targeted communication only

## Example Integration

In Markets instance's HEARTBEAT.md:

```markdown
## Step 2: Do the Work

Monitor arb bot, check P&L, scan opportunities

## Step 3: Then Check

1. Run collective sync: `bash /home/agent/clawd/scripts/collective-sync.sh`
2. Check for dev handoffs (if exit logic bugs found)
3. Check arb bot logs for errors
4. Update digest if major changes

## Step 4: Report

Report findings to group + update digest
```

---

**The result:** Each instance stays informed without being overwhelmed. Signal, not noise. ğŸ‰
